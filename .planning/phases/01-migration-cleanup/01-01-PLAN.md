---
phase: 01-migration-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - package.json
  - src/lib/manifest.ts
  - src/pages/bookmarks-edit.tsx
  - scripts/finalize.ts
  - scripts/tunnel.ts
  - data/
  - bun.lock
  - lib/db/content.ts
  - lib/db/index.ts
  - lib/db/learnings.ts
  - server/cli.ts
  - server/stdio.ts
  - server/tools.ts
  - scripts/import-social-posts.ts
  - scripts/seed-projects.ts
  - README.md
  - DEPLOY.md
  - SETUP_GUIDE.md
  - scripts/build.ts
  - scripts/generate.ts
  - vite.config.ts
  - lefthook.yml
  - blog/config.json
  - blog/tone-of-voice.md
  - blog/visual-style.md
  - lib/articles.ts
autonomous: true

must_haves:
  truths:
    - "No SQLite references remain in source code, configs, or .gitignore (blog articles and planning docs excluded)"
    - "bun run pages:build succeeds without --experimental-sqlite flag"
    - "bun run test:e2e passes"
    - "bun run test:constraints passes"
    - "All migration changes are committed in a single clean commit"
    - "Pre-commit hook stages blog/articles/ files (not data/content.db)"
  artifacts:
    - path: ".gitignore"
      provides: "Updated ignore rules: data/ and .cursor/ added, SQLite WAL section removed"
      contains: "data/"
    - path: "lib/articles.ts"
      provides: "New article reading layer replacing lib/db/"
    - path: "blog/config.json"
      provides: "Blog configuration asset"
    - path: "package.json"
      provides: "Clean scripts without tunnel or experimental-sqlite references"
  key_links:
    - from: "scripts/build.ts"
      to: "node (pages mode)"
      via: "pages:build script in package.json"
      pattern: "node --no-warnings --experimental-strip-types"
    - from: "scripts/generate.ts"
      to: "lib/articles.ts"
      via: "import replacing old lib/db import"
      pattern: "import.*lib/articles"
    - from: "lefthook.yml"
      to: "blog/articles/"
      via: "pre-commit staging glob"
      pattern: "blog/articles/"
---

<objective>
Clean up the half-done SQLite-to-Supabase migration: delete SQLite artifacts, remove stale references, commit all Feb 9 changes, and verify builds/tests pass.

Purpose: The repository has uncommitted migration changes from Feb 9. SQLite files (lib/db/, server/, old scripts) were deleted but never committed. New files (lib/articles.ts, blog assets) exist but are untracked. Stale SQLite references linger in comments and configs. This plan produces a clean, committed, building repository ready for Phase 2.

Output: Single cleanup commit with all migration changes staged, SQLite artifacts removed, stale references fixed, build and tests verified green.
</objective>

<execution_context>
@/Users/guilherme/.claude/get-shit-done/workflows/execute-plan.md
@/Users/guilherme/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-migration-cleanup/01-CONTEXT.md
@.planning/phases/01-migration-cleanup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete artifacts, fix stale references, update configs</name>
  <files>
    data/
    scripts/tunnel.ts
    .gitignore
    package.json
    src/lib/manifest.ts
    src/pages/bookmarks-edit.tsx
    scripts/finalize.ts
  </files>
  <action>
Execute the following cleanup operations:

1. **Delete artifacts from disk:**
   - Delete the entire `data/` directory (`rm -rf data/`)
   - Delete `scripts/tunnel.ts`

2. **Update .gitignore:**
   - Remove the "SQLite WAL temp files" section (lines with `data/*.db-shm`, `data/*.db-wal`)
   - Remove the "Bookmarks DB" entry (`data/bookmarks.db` and its comment)
   - Remove the "Local-only learnings database" entry (`data/learnings.db` and its comment)
   - Remove the "Generated from SQLite" comment — update to say "Generated at build time"
   - Add `data/` entry (entire directory ignored)
   - Add `.cursor/` entry (IDE-specific config)

3. **Fix stale SQLite comments in source code:**
   - `src/lib/manifest.ts` line 4: change comment from "generated from SQLite" to "generated at build time" (or similar accurate description)
   - `src/pages/bookmarks-edit.tsx` line 95: change comment from "loaded from SQLite via /api/bookmarks" to "loaded from Supabase" (or remove the stale reference)
   - `scripts/finalize.ts` line 9: change comment from "Does NOT require SQLite" to remove the SQLite mention entirely (just describe what finalize does)

4. **Remove tunnel scripts from package.json:**
   - Remove `"dev:tunnel"` script entry
   - Remove `"preview:tunnel"` script entry

5. **Verify pages:build script uses correct flags:**
   - Confirm `scripts/build.ts` diff already removed `--experimental-sqlite` from pages mode (it should be in the unstaged changes)
   - If `package.json` still has `--experimental-sqlite` in `pages:build`, remove it. The script should be: `"pages:build": "node --no-warnings --experimental-strip-types scripts/build.ts --mode=pages"`

6. **Do a full grep sweep for remaining SQLite references:**
   - Search all non-blog, non-planning files for "sqlite", "SQLite", "bun:sqlite", "experimental-sqlite"
   - Fix any additional stale references found (update comments, remove imports)
   - Do NOT touch: blog/articles/*.md (content), .planning/ (docs), anything mentioning Firefox bookmarks SQLite (that's reading FROM Firefox, not project storage)

7. **Verify documentation accuracy:**
   - Read README.md diff — confirm it accurately describes the markdown-based system (no stale SQLite setup steps)
   - Read DEPLOY.md diff — confirm it has no SQLite deployment instructions
   - Read SETUP_GUIDE.md — the research notes remaining SQLite mentions are about MCP Mesh (external tool), which is fine to keep. But verify no stale "install SQLite" or "run migrations" steps exist for THIS project

8. **Regenerate bun.lock:**
   - Delete existing `bun.lock`
   - Run `bun install` to regenerate fresh from package.json
  </action>
  <verify>
Run these checks:
- `grep -ri "sqlite" --include="*.ts" --include="*.tsx" --include="*.json" --include="*.yml" --include="*.yaml" --exclude-dir=node_modules --exclude-dir=.planning --exclude-dir=blog --exclude-dir=.cursor /Users/guilherme/Projects/vibegui.com` should return zero matches (or only Firefox bookmarks references)
- `test ! -d /Users/guilherme/Projects/vibegui.com/data` confirms data/ deleted
- `test ! -f /Users/guilherme/Projects/vibegui.com/scripts/tunnel.ts` confirms tunnel.ts deleted
- `grep "dev:tunnel" /Users/guilherme/Projects/vibegui.com/package.json` returns no match
- `grep "experimental-sqlite" /Users/guilherme/Projects/vibegui.com/package.json` returns no match
- `grep "data/" /Users/guilherme/Projects/vibegui.com/.gitignore` confirms data/ is ignored
- `grep ".cursor/" /Users/guilherme/Projects/vibegui.com/.gitignore` confirms .cursor/ is ignored
  </verify>
  <done>
All SQLite artifacts deleted from disk. All stale SQLite references in source comments updated. .gitignore cleaned up with data/ and .cursor/ added. Tunnel scripts removed from package.json. bun.lock regenerated fresh. No SQLite references remain in source/config files (excluding blog content and planning docs).
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify build and tests, then commit all changes</name>
  <files>
    bun.lock
    lib/db/content.ts
    lib/db/index.ts
    lib/db/learnings.ts
    server/cli.ts
    server/stdio.ts
    server/tools.ts
    scripts/import-social-posts.ts
    scripts/seed-projects.ts
    README.md
    DEPLOY.md
    SETUP_GUIDE.md
    scripts/build.ts
    scripts/generate.ts
    vite.config.ts
    lefthook.yml
    blog/config.json
    blog/tone-of-voice.md
    blog/visual-style.md
    lib/articles.ts
  </files>
  <action>
1. **Run build to verify it works without SQLite:**
   - Execute `bun run pages:build` — must succeed
   - If it fails due to stale SQLite imports or references, fix them autonomously (remove imports, update references) then retry
   - The build should complete with zero SQLite-related errors

2. **Run tests:**
   - Execute `bun run test:constraints` — must pass
   - Execute `bun run test:e2e` — must pass
   - If tests fail due to stale SQLite references, fix autonomously and retry

3. **Review all changes one final time:**
   - Run `git status` to see the full picture of staged/unstaged/untracked
   - Run `git diff` on each modified file to confirm all changes are migration-related
   - If any diff looks unrelated to the migration (wrong config change, unrelated code edit): leave it unstaged and note what was skipped in the summary

4. **Stage and commit everything in a single commit:**
   - Stage all deleted files: `git rm lib/db/content.ts lib/db/index.ts lib/db/learnings.ts server/cli.ts server/stdio.ts server/tools.ts scripts/import-social-posts.ts scripts/seed-projects.ts scripts/tunnel.ts`
   - Stage all modified files: `git add README.md DEPLOY.md SETUP_GUIDE.md package.json scripts/build.ts scripts/generate.ts vite.config.ts lefthook.yml bun.lock .gitignore src/lib/manifest.ts src/pages/bookmarks-edit.tsx scripts/finalize.ts`
   - Stage all new files: `git add blog/config.json blog/tone-of-voice.md blog/visual-style.md lib/articles.ts`
   - Do NOT stage `.cursor/` (should be gitignored)
   - Do NOT stage `.planning/` changes in this commit (planning docs are separate)
   - Create commit with a descriptive message summarizing the migration cleanup

5. **Post-commit verification:**
   - Run `git status` to confirm working tree is clean (except .planning/ and .cursor/)
   - Run `git log --oneline -1` to confirm the commit was created
  </action>
  <verify>
- `bun run pages:build` succeeds (exit code 0)
- `bun run test:constraints` passes
- `bun run test:e2e` passes
- `git log --oneline -1` shows the cleanup commit
- `git status` shows clean working tree (only .planning/ and .cursor/ as expected untracked/modified)
- `git show --stat HEAD` shows all expected files in the commit
  </verify>
  <done>
Build succeeds without --experimental-sqlite. All tests pass (E2E and constraints). Single cleanup commit contains all migration changes: 8 deleted files, modified configs/docs, 4 new files (lib/articles.ts, blog assets). Working tree is clean except for planning docs.
  </done>
</task>

</tasks>

<verification>
Phase 1 requirements coverage:
- MIGR-01: All unstaged migration changes reviewed and committed (Task 2)
- MIGR-02: data/ directory deleted, added to .gitignore (Task 1)
- MIGR-03: SETUP_GUIDE.md has no project-level SQLite references (Task 1 step 7)
- MIGR-04: README.md and DEPLOY.md accurately describe markdown-based system (Task 1 step 7)
- MIGR-05: bun run pages:build succeeds without --experimental-sqlite (Task 2 step 1)
- MIGR-06: E2E tests pass (Task 2 step 2)
- MIGR-07: Constraint tests pass (Task 2 step 2)
- MIGR-08: Pre-commit hook stages blog/articles/ files (lefthook.yml already updated in unstaged changes)
</verification>

<success_criteria>
1. `git log --oneline -1` shows a migration cleanup commit
2. `grep -ri "sqlite" --include="*.ts" --include="*.tsx" --include="*.json" --include="*.yml" /Users/guilherme/Projects/vibegui.com/src /Users/guilherme/Projects/vibegui.com/scripts` returns zero matches (or only Firefox-related)
3. `bun run pages:build` exits 0
4. `bun run test:e2e` exits 0
5. `bun run test:constraints` exits 0
6. `test ! -d data/` passes
7. `git status` shows clean tree (except .planning/)
</success_criteria>

<output>
After completion, create `.planning/phases/01-migration-cleanup/01-01-SUMMARY.md`
</output>
