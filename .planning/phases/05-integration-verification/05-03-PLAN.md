---
phase: 05-integration-verification
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified: [tests/e2e/pipeline.spec.ts]
autonomous: false
requirements: [E2EV-01, E2EV-02]

must_haves:
  truths:
    - "Full pipeline works: sync -> generate -> vite build produces dist/ with article HTML files"
    - "Local preview server serves article pages with HTTP 200"
    - "Article pages contain actual content (not empty shell or SPA fallback)"
    - "Content index page lists articles from manifest"
  artifacts:
    - path: "tests/e2e/pipeline.spec.ts"
      provides: "E2E pipeline verification tests"
      min_lines: 30
  key_links:
    - from: "tests/e2e/pipeline.spec.ts"
      to: "http://localhost:4002"
      via: "Playwright webServer config"
      pattern: "page\\.goto"
    - from: "tests/e2e/pipeline.spec.ts"
      to: "dist/"
      via: "preview-server serving built files"
      pattern: "article.*200|toBeVisible"
---

<objective>
Verify the complete E2E pipeline works: Supabase articles are synced, built into static HTML, and served correctly by the preview server. Add Playwright tests that prove article pages render with real content.

Purpose: Prove the entire Supabase-first pipeline produces a working site, end to end.
Output: tests/e2e/pipeline.spec.ts with pipeline verification tests.
</objective>

<execution_context>
@/Users/guilherme/.claude/get-shit-done/workflows/execute-plan.md
@/Users/guilherme/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-integration-verification/05-RESEARCH.md
@tests/e2e/content.spec.ts
@playwright.config.ts
@scripts/preview-server.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create E2E pipeline verification tests</name>
  <files>tests/e2e/pipeline.spec.ts</files>
  <action>
Create `tests/e2e/pipeline.spec.ts` with Playwright tests that verify the full pipeline output.

**Pre-condition:** The dist/ directory must already be built (the existing pre-commit pipeline runs `bun run build` before `bun run test:e2e`, and Playwright webServer config starts preview-server automatically). Do NOT run sync or build inside the test -- just verify what is already built.

**Test 1: Article pages served from dist (E2EV-02)**
- Navigate to `/article/hello-world-building-an-mcp-native-blog` (known stable article already used in existing E2E tests in content.spec.ts)
- Assert HTTP response status is 200
- Assert an `article` element is visible on the page
- Assert "Article not found" text is NOT visible (proves real content, not SPA fallback)

**Test 2: Content index lists articles from manifest (E2EV-01)**
- Navigate to `/content`
- Wait for `domcontentloaded`
- Find article links (elements matching `a[href*='/article/']`)
- Assert count is greater than 0 (proves generate.ts produced a manifest with articles)

**Test 3: Multiple article pages render (E2EV-01 + E2EV-02)**
- Navigate to `/content`
- Collect the first 3 article link hrefs
- For each href, navigate to it and assert:
  - Response status is 200
  - An `article` or `main` content element is visible
- This proves the pipeline works for multiple articles, not just one hardcoded slug

**Key details:**
- Use the same test structure as existing `tests/e2e/content.spec.ts`
- The Playwright config already has `webServer` pointing to preview-server on port 4002
- Use `test.describe("E2E Pipeline Verification", ...)` as the describe block
- Do NOT import or depend on any project source files -- these are pure browser tests
  </action>
  <verify>
1. `bun run build` succeeds (pre-condition for E2E tests)
2. `bun run test:e2e` passes including the new pipeline.spec.ts tests
3. `grep "pipeline.spec" tests/e2e/pipeline.spec.ts` confirms file exists
  </verify>
  <done>E2E pipeline tests pass: article pages serve with HTTP 200, content index lists articles, multiple articles render correctly from the built dist directory.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify full pipeline integration end-to-end</name>
  <action>Human verifies the complete Phase 5 integration works end-to-end.</action>
  <what-built>Complete Phase 5 integration: pre-commit warning hook, documentation updates, article helper functions, and E2E pipeline verification tests. The full pipeline (Supabase -> sync -> generate -> build -> preview) is verified working.</what-built>
  <how-to-verify>
1. Run `bun run sync` -- should sync articles from Supabase to blog/articles/
2. Run `bun run build` -- should generate site into dist/
3. Run `bun run preview` -- should start server on http://localhost:4002
4. Visit http://localhost:4002/content -- should show article list
5. Click any article -- should render with full content
6. Stop preview, then stage a blog/articles/*.md file and run `git commit` -- should see warning about build artifacts
7. Check `cat blog/articles/README.md` -- should explain files are build artifacts
  </how-to-verify>
  <verify>Human confirms all steps pass</verify>
  <done>User approves the full pipeline integration</done>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `bun run test:e2e` passes (all E2E tests including new pipeline.spec.ts)
2. `bun run sync && bun run build` completes without errors (E2EV-01)
3. Preview server serves articles at http://localhost:4002 (E2EV-02)
</verification>

<success_criteria>
- Full pipeline works: Supabase -> sync -> generate -> build -> dist (E2EV-01)
- Local preview serves articles correctly with HTTP 200 (E2EV-02)
- E2E tests prove the pipeline output is correct
- Human verification confirms the full integration works
</success_criteria>

<output>
After completion, create `.planning/phases/05-integration-verification/05-03-SUMMARY.md`
</output>
