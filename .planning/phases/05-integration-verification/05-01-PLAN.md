---
phase: 05-integration-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [lefthook.yml, blog/articles/README.md, README.md, AGENTS.md]
autonomous: true
requirements: [ENFC-01, ENFC-02]

must_haves:
  truths:
    - "Pre-commit hook warns when blog/articles/*.md files are manually staged"
    - "Warning does NOT block the commit (exits 0)"
    - "Warning does NOT fire during normal build pipeline (only fires as step 0, before build stages articles)"
    - "Documentation in blog/articles/README.md states files are build artifacts"
    - "README.md documents the DB-first workflow"
    - "AGENTS.md documents helper functions and DB-first workflow for AI agents"
  artifacts:
    - path: "lefthook.yml"
      provides: "0_warn_articles command before existing pipeline"
      contains: "0_warn_articles"
    - path: "blog/articles/README.md"
      provides: "Build artifact notice for articles directory"
      contains: "build artifacts"
    - path: "README.md"
      provides: "Updated project docs with DB-first workflow"
      contains: "Supabase"
    - path: "AGENTS.md"
      provides: "AI agent documentation for article management"
      contains: "article-helpers"
  key_links:
    - from: "lefthook.yml"
      to: "blog/articles/*.md"
      via: "glob filter on staged files"
      pattern: "glob.*blog/articles"
---

<objective>
Add direction enforcement: a lefthook pre-commit warning when blog/articles/*.md files are manually staged, plus documentation updates stating markdown files are build artifacts synced from Supabase.

Purpose: Prevent developers (and AI agents) from editing markdown articles directly, since Supabase is the source of truth and sync overwrites local changes.
Output: Updated lefthook.yml with warning command, blog/articles/README.md notice, updated README.md and AGENTS.md.
</objective>

<execution_context>
@/Users/guilherme/.claude/get-shit-done/workflows/execute-plan.md
@/Users/guilherme/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-integration-verification/05-RESEARCH.md
@lefthook.yml
@README.md
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add lefthook pre-commit warning for article file edits</name>
  <files>lefthook.yml</files>
  <action>
Add a `0_warn_articles` command as the FIRST command in the pre-commit pipeline (before `1_format`). This must run BEFORE `4_build` and `5_stage` because the build pipeline itself stages `blog/articles/` files, which would cause false positives if the warning ran later.

Configuration:
```yaml
0_warn_articles:
  glob: "blog/articles/*.md"
  run: |
    echo ""
    echo "WARNING: blog/articles/*.md files are staged."
    echo "These are build artifacts synced from Supabase."
    echo "Direct edits will be overwritten on next sync."
    echo "Edit in Supabase, then: bun run sync"
    echo ""
```

Key details:
- Use `glob: "blog/articles/*.md"` so the command ONLY runs when those files are staged
- The command must exit 0 (no `fail_text`, no non-zero exit) -- it warns but does NOT block
- The numbered prefix `0_` ensures it runs first in the piped pipeline
- Do NOT change any other existing commands in lefthook.yml
  </action>
  <verify>
Run `cat lefthook.yml` and confirm:
1. `0_warn_articles` is the first command in pre-commit
2. It has `glob: "blog/articles/*.md"`
3. It echoes a warning message
4. No `fail_text` or exit codes that would block the commit
5. All existing commands (1_format through 7_e2e) are unchanged
  </verify>
  <done>Lefthook pre-commit pipeline has a `0_warn_articles` step that fires only when blog/articles/*.md files are manually staged, prints a warning, and does not block the commit.</done>
</task>

<task type="auto">
  <name>Task 2: Add documentation stating markdown files are build artifacts</name>
  <files>blog/articles/README.md, README.md, AGENTS.md</files>
  <action>
1. **Create `blog/articles/README.md`** with a clear notice:
   - State these files are build artifacts synced from Supabase
   - State they should NOT be edited directly
   - Provide the workflow: edit in Supabase -> `bun run sync` -> `bun run build` -> `bun run preview`
   - Keep it short (under 20 lines)

2. **Update `README.md`** -- find the section about content/articles and add a note:
   - State that article markdown files are generated from Supabase via `bun run sync`
   - State Supabase is the source of truth for articles
   - Mention the `bun run sync` command
   - If there is no content section, add a brief "Content Pipeline" section near other workflow docs

3. **Update `AGENTS.md`** -- add documentation for AI agents:
   - State that articles are managed in Supabase (source of truth)
   - State that `blog/articles/*.md` are build artifacts, not to be edited directly
   - Document the `lib/article-helpers.ts` module (will be created in Plan 02) with createArticle, updateArticle, getArticleBySlug functions
   - Document the workflow: use helpers or Supabase MCP to create/edit articles, then `bun run sync` to export
   - If AGENTS.md does not exist, create it
  </action>
  <verify>
1. `cat blog/articles/README.md` exists and contains "build artifacts" and "Supabase"
2. `grep -c "sync" README.md` returns at least 1 match
3. `grep -c "article-helpers" AGENTS.md` returns at least 1 match
  </verify>
  <done>Three documentation files updated: blog/articles/README.md explains files are build artifacts, README.md documents DB-first workflow, AGENTS.md documents article management for AI agents.</done>
</task>

</tasks>

<verification>
1. `grep "0_warn_articles" lefthook.yml` confirms warning command exists
2. `cat blog/articles/README.md` shows build artifact notice
3. `grep "Supabase" README.md` confirms DB-first documentation
4. `grep "article-helpers" AGENTS.md` confirms agent documentation
</verification>

<success_criteria>
- Pre-commit hook warns on blog/articles/*.md changes (ENFC-01)
- Documentation clearly states markdown files are build artifacts (ENFC-02)
- Warning is non-blocking (exits 0)
- All existing lefthook commands unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/05-integration-verification/05-01-SUMMARY.md`
</output>
