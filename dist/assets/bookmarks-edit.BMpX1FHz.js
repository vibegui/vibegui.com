const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bookmark-modal.D_NTTl-S.js","assets/react.Cu7fmCo9.js","assets/markdown.BaswSlok.js"])))=>i.map(i=>d[i]);
import{P as xt,_ as yt}from"./index.LY3Qe_MF.js";import{a as d,R as ce,j as t}from"./react.Cu7fmCo9.js";import{s as bt,B as vt,c as Qe,g as wt}from"./bookmark-modal.D_NTTl-S.js";import"./react-dom.Ch-CG1a-.js";import"./markdown.BaswSlok.js";function $(n,N){return n?.includes(N)??!1}const Nt={github:/github\.com/i,linkedin:/linkedin\.com/i,twitter:/twitter\.com|x\.com/i,youtube:/youtube\.com|youtu\.be/i,instagram:/instagram\.com/i,medium:/medium\.com/i,substack:/substack\.com/i,reddit:/reddit\.com/i,hackernews:/news\.ycombinator\.com/i,discord:/discord\.com|discord\.gg/i};function Ze(n){for(const[N,j]of Object.entries(Nt))if(j.test(n))return N;return null}const be={mcp:{label:"MCP Developer",color:"#8b5cf6",icon:"ğŸ”Œ"},founder:{label:"Startup Founder",color:"#f59300",icon:"ğŸš€"},investor:{label:"VC Investor",color:"#10b981",icon:"ğŸ’°"}};function Xe({stars:n}){return n?t.jsxs("span",{title:`${n}/5`,children:["â­".repeat(n),t.jsx("span",{className:"opacity-30",children:"â˜†".repeat(5-n)})]}):t.jsx("span",{className:"text-gray-400",children:"â€”"})}async function $e(n,N){const j=await fetch("/api/mesh/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toolName:n,args:N})});if(!j.ok){const g=await j.text();throw new Error(`Mesh call failed: ${j.status} - ${g}`)}const C=await j.json();if(C.error)throw new Error(C.error.message||JSON.stringify(C.error));return C.result??C}async function Pe(n,N=2,j=2e3){let C=null;for(let g=0;g<=N;g++)try{return await n()}catch(M){if(C=M,!(C.message.includes("timed out")||C.message.includes("timeout")||C.message.includes("rate limit")||C.message.includes("429"))||g===N)throw C;const W=j*2**g+Math.random()*1e3;console.log(`[Retry] Attempt ${g+1} failed, retrying in ${Math.round(W)}ms...`),await new Promise(D=>setTimeout(D,W))}throw C}async function Ie(n,N,j={runResearch:!0,runContent:!0,runAnalysis:!0},C){let g=C?.research||"",M=C?.content||"",I,W;if(j.runResearch||j.runContent){N(1,`Fetching${j.runResearch?" Perplexity":""}${j.runResearch&&j.runContent?" +":""}${j.runContent?" Firecrawl":""}...`);const _=[],f=[];j.runResearch&&(_.push(Pe(()=>$e("perplexity_ask",{messages:[{role:"user",content:`Research ${n.url}:

1. WHAT: One-sentence description. Key features.
2. TECH: Stack, languages, open source? GitHub stats if available.
3. BUSINESS: Pricing model, competitors, traction (users/funding).
4. TEAM: Who made it? Background.
5. STATUS: Last update, actively maintained?
6. DATE: Original release/publish date (YYYY-MM-DD if possible).

Be factual and concise.`}]}))),f.push("research")),j.runContent&&(_.push(Pe(()=>$e("firecrawl_scrape",{url:n.url,formats:["markdown"],onlyMainContent:!0}))),f.push("content"));const Y=await Promise.all(_);let u,S;for(const[x,h]of f.entries())h==="research"&&(u=Y[x]),h==="content"&&(S=Y[x]);if(u){if(u.isError){const x=Array.isArray(u.content)?u.content.find(h=>h.type==="text")?.text:typeof u.content=="string"?u.content:"Unknown error";throw new Error(`Perplexity research failed: ${x}`)}if(typeof u.answer=="string")g=u.answer;else if(u.structuredContent?.answer)g=u.structuredContent.answer;else if(Array.isArray(u.content)){const x=u.content.find(h=>h.type==="text");if(x?.text)try{const h=JSON.parse(x.text);if(h.isError||h.error)throw new Error(`Perplexity research failed: ${h.error||h.text||"Unknown error"}`);g=h.answer??x.text}catch(h){if(h instanceof Error&&h.message.includes("Perplexity research failed"))throw h;g=x.text}}else typeof u.content=="string"&&(g=u.content);if(!g||g.includes("MCP error")||g.includes("Invalid arguments"))throw new Error(`Perplexity research failed: ${g||"No response"}`);W=new Date().toISOString()}if(S){if(typeof S.markdown=="string")M=S.markdown;else if(Array.isArray(S.content)){const h=S.content.find(H=>H.type==="text");if(h?.text)try{M=JSON.parse(h.text).markdown||h.text}catch{M=h.text}}const x=S.metadata;if(x){const h=["article:published_time","og:article:published_time","datePublished","publishedTime","date","pubdate","publish_date","created","createdAt"];for(const H of h){const de=x[H];if(de&&typeof de=="string"){const Z=new Date(de);if(!Number.isNaN(Z.getTime())){I=Z.toISOString(),console.log(`[Enrichment] Found publish date from metadata.${H}:`,I);break}}}}}}else N(1,"Skipping fetch (using existing data)...");if(console.log("[Enrichment] Research length:",g.length),console.log("[Enrichment] Page content length:",M.length),!j.runAnalysis)return N(2,"Skipping analysis..."),{url:n.url,title:n.title,description:n.description,perplexity_research:g||null,firecrawl_content:M||null,researched_at:W||null,stars:n.stars||3,language:null,icon:n.icon||null,insight_dev:null,insight_founder:null,insight_investor:null,classified_at:new Date().toISOString(),published_at:I||null,tags:n.tags||[]};N(2,"Classifying with Gemini 2.5 Flash...");const D=await $e("mcp_openrouter_chat_completion",{model:"google/gemini-2.5-flash",messages:[{role:"system",content:`You are â€œVibeGUI Bookmark Analystâ€: an ultra-high-value, high-context reviewer enriching bookmarks for https://vibegui.com.  
You receive:
- RESEARCH â†’ short Perplexity summary (with citations, release info, repo data)
- PAGE â†’ Firecrawl scrape (full text, metadata, title, date hints)
- URL â†’ the original resource

Your task: return ONE valid JSON object (no markdown, no explanation) that will render correctly in the VibeGUI library UI.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
OUTPUT JSON SCHEMA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  "stars": <integer 1-5>,
  "language": "<ISO 639-1 code>",
  "icon": "<single emoji>",
  "title": "<original page title, or improved if original is missing/poor>",
  "description": "<1-2 sentences, â‰¤240 chars>",
  "tags": ["tech:...", "persona:...", "type:..."],
  "insight_dev": ["<paragraph 1>", "<paragraph 2>", "<paragraph 3>", "<paragraph 4>", "<paragraph 5>"],
  "insight_founder": ["<paragraph 1>", "<paragraph 2>", "<paragraph 3>", "<paragraph 4>", "<paragraph 5>"],
  "insight_investor": ["<paragraph 1>", "<paragraph 2>", "<paragraph 3>", "<paragraph 4>", "<paragraph 5>"],
  "published_at": "<ISO 8601 or null>"
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
JSON RULES (CRITICAL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Output exactly one JSON object, no markdown fences.
2. Each insight is an ARRAY of 4-5 strings (one paragraph each). ALWAYS include at least 4.
3. Each paragraph is 2-4 sentences, plain text, no bullet markers.
4. Use straight quotes only. Avoid special characters.
5. Do not use pipe | separators.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STAR RATING â€” BE RUTHLESS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 â­ spam / broken / outdated / irrelevant  
2 â­ generic or shallow  
3 â­ solid and useful but common  
4 â­ strong execution, distinct insight  
5 â­ exceptional or category-defining  

(Most links should be 2-3 â­.)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TITLE GUIDELINES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PREFER THE ORIGINAL PAGE TITLE. Only modify if:
- Original is missing or generic ("Untitled", "Home")
- Original is clickbait/misleading
- Original is extremely long (>80 chars) â€” shorten while preserving meaning

DO NOT rewrite good titles just to be "catchy". The author's title is usually best.
If shortening, never truncate with "..." â€” rephrase to be complete but concise.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ICON GUIDELINES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Any emoji allowed.  
Common picks: ğŸ§  idea, ğŸ§° tool, âš™ï¸ infra, ğŸ“š doc, ğŸ’¡ concept, ğŸš€ launch, ğŸ”’ security, ğŸª„ UI, ğŸ§ª research, ğŸ› ï¸ code, ğŸ§­ strategy, ğŸ’¸ biz, ğŸŒ data, ğŸ§‘â€ğŸ’» dev, ğŸ”¥ trend.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TAG SYSTEM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Always include â‰¥1 persona tag:
persona:mcp_developer â€¢ persona:startup_founder â€¢ persona:vc_investor  
Use 3-8 concise tags:
- tech:<stack or protocol> â€” e.g. tech:mcp, tech:typescript, tech:llm, tech:agents  
- type:<form> â€” e.g. type:tool, type:paper, type:repo, type:blog, type:product  
- topic:<theme> â€” e.g. topic:observability, topic:prompting, topic:security  
- stage:<maturity> â€” e.g. stage:research, stage:beta, stage:prod  

Prefer precision over quantity.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INSIGHT ARRAYS (4-5 paragraphs each, 2-4 sentences per paragraph)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
**insight_dev** (MCP / AI Developer) â€” technical only  
Integration, API design, DX, limitations, LLM/Agent interop, gotchas. Agentic workflows, MCP servers.

**insight_founder** (Startup Founder) â€” business & strategy only  
Problem solved, target user, differentiation, moat, strategic move. How to use for my startup?

**insight_investor** (VC / Market) â€” investment view only  
Market trends, competitive signals, defensibility, risk/reward. Evolution of AI.

Never mix personas. Each array element is one standalone paragraph.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PUBLISH DATE EXTRACTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Goal: *original publish / release / announcement date*  
Order of checks:
1ï¸âƒ£ RESEARCH â†’ look for â€œlaunchedâ€, â€œreleasedâ€, â€œannouncedâ€, â€œpublishedâ€.  
2ï¸âƒ£ PAGE â†’ meta tags, byline, footer, JSON-LD, changelog, version notes.  
3ï¸âƒ£ GitHub â†’ first release > first commit > repo created (only if explicit).  

Format as ISO 8601 UTC:
- Full date â†’ "2025-03-12T00:00:00.000Z"  
- Only month/year â†’ use first of month  
- Only year â†’ use Jan 1  
If none found â†’ null.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELF-CHECK
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ” Each insight field is an array of 4-5 strings (minimum 4!)
âœ” No pipe separators, no bullet markers
âœ” JSON is syntactically valid
âœ” No markdown fences

Output the JSON object only.
`},{role:"user",content:`Analyze this resource:

URL: ${n.url}
Title: ${n.title||"Unknown"}
Description: ${n.description||"No description"}

RESEARCH (from Perplexity):
${g}

${M?`PAGE CONTENT (from Firecrawl):
${M}`:""}`}],temperature:.3,max_tokens:16384});let K="";typeof D=="string"?K=D:D?.content&&Array.isArray(D.content)?K=D.content.find(f=>f.type==="text")?.text??"":K=JSON.stringify(D),console.log("[Enrichment] Raw AI response:",K.slice(0,800));const O=K.match(/\{[\s\S]*\}/);if(!O)throw new Error(`Failed to parse classification JSON from: ${K.slice(0,500)}`);let b;const F=_=>{try{return JSON.parse(_)}catch{}let f=!1,Y=!1,u="";for(const S of _){if(Y){u+=S,Y=!1;continue}if(S==="\\"){u+=S,Y=!0;continue}if(S==='"'){f=!f,u+=S;continue}if(f&&S===`
`){u+="\\n";continue}if(f&&S==="\r")continue;const x=S.charCodeAt(0);if(x>=0&&x<=8||x===11||x===12||x>=14&&x<=31){u+=" ";continue}u+=S}return u=u.replace(/"\s*\n\s*"/g,`",
  "`),JSON.parse(u)};try{b=F(O[0])}catch(_){const f=_;throw console.error("[Enrichment] JSON parse error:",f.message),console.error("[Enrichment] Problematic JSON:",O[0].slice(0,1e3)),new Error(`${n.title||n.url}: ${f.message}`)}console.log("[Enrichment] Parsed fields:",{stars:b.stars,icon:b.icon,insight_dev:Array.isArray(b.insight_dev)?`[${b.insight_dev.length} items]`:b.insight_dev?.slice(0,50)});const ie=_=>_?Array.isArray(_)?_.map(f=>`- ${f.trim()}`).join(`

`):_.replace(/\s*\|\s*-\s*/g,`

- `).replace(/\.,\s*-\s*/g,`.

- `).replace(/,\s*-\s+/g,`

- `):null,U=typeof b.stars=="number"?b.stars:3,Q=Array.isArray(b.tags)?b.tags:[],L=$(Q,"persona:mcp_developer"),Ce=$(Q,"persona:startup_founder"),J=$(Q,"persona:vc_investor");return!L&&!Ce&&!J&&Q.push("persona:mcp_developer"),{url:n.url,title:b.title||n.title,description:b.description||n.description,perplexity_research:g,firecrawl_content:M||null,researched_at:W||null,stars:U,language:b.language||null,icon:b.icon||null,insight_dev:ie(b.insight_dev),insight_founder:ie(b.insight_founder),insight_investor:ie(b.insight_investor),classified_at:new Date().toISOString(),published_at:I||(b.published_at&&b.published_at!=="null"?b.published_at:null),tags:Q}}function et(n){return{id:n.id,url:n.url,title:n.title,description:n.description,icon:n.icon,stars:n.stars,classified_at:n.classified_at,published_at:n.published_at,tags:n.tags}}const re=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");function Tt(){const[n,N]=d.useState([]),[j,C]=d.useState(!0),[g,M]=d.useState(null),[I,W]=d.useState(""),[D,K]=d.useState(!1),[O,b]=d.useState(null),[F,ie]=d.useState(null),[U,Q]=d.useState(null),[L,Ce]=d.useState("published"),[J,_]=d.useState(null),[f,Y]=d.useState(null),[u,S]=d.useState(!1),[x,h]=d.useState(!1),[H,de]=d.useState(!1),[Z,tt]=d.useState("all"),[G,ve]=d.useState(null),[se,R]=d.useState(null),ne=d.useRef([]),[X,ee]=d.useState(null),[we,Me]=d.useState([]),[Oe,ue]=d.useState(new Map),[oe,rt]=d.useState(5),[Se,st]=d.useState(3),[le,De]=d.useState(""),[pe,ke]=d.useState(!1),[nt,Be]=d.useState(new Set),[E,_e]=d.useState({research:!0,content:!0,analysis:!0}),[Fe,Ee]=d.useState(null),[Re,Ue]=d.useState(!1),Te=e=>{ue(r=>{const s=new Map(r);return s.delete(e),s}),Me(r=>r.includes(e)?r:[...r,e])},P=(e,r="dev")=>{ve({url:e,tab:r})},Le=async e=>{try{if(!(await fetch("/api/bookmarks/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})})).ok)throw new Error("Failed to delete");N(s=>s.filter(l=>l.url!==e)),ee(null),R(null)}catch(r){console.error("Delete failed:",r),alert("Failed to delete bookmark")}},ot=()=>ve(null),B=G?n.find(e=>e.url===G.url):null,Ae=d.useRef({selectedRowIndex:se,modalOpen:!!G});Ae.current={selectedRowIndex:se,modalOpen:!!G},ce.useEffect(()=>{const e=r=>{if(Ae.current.modalOpen||r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)return;const s=ne.current,l=Ae.current.selectedRowIndex;if(r.key==="ArrowDown"||r.key==="j")r.preventDefault(),R(a=>{const i=a===null?0:Math.min(a+1,s.length-1);return setTimeout(()=>{document.getElementById(`bookmark-row-${i}`)?.scrollIntoView({block:"nearest",behavior:"smooth"})},0),i});else if(r.key==="ArrowUp"||r.key==="k")r.preventDefault(),R(a=>{const i=a===null?s.length-1:Math.max(a-1,0);return setTimeout(()=>{document.getElementById(`bookmark-row-${i}`)?.scrollIntoView({block:"nearest",behavior:"smooth"})},0),i});else if(r.key==="Enter"&&l!==null){r.preventDefault();const a=s[l];a?.classified_at&&P(a.url)}else if(re&&(r.key==="Delete"||r.key==="Backspace")&&l!==null){r.preventDefault();const a=s[l];a&&ee({url:a.url,title:a.title||a.url})}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const Je=d.useRef(X);Je.current=X,ce.useEffect(()=>{const e=r=>{const s=Je.current;s&&(r.key==="Enter"?(r.preventDefault(),Le(s.url)):r.key==="Escape"&&(r.preventDefault(),ee(null)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const[p,y]=d.useState({isRunning:!1,current:null,currentStep:0,stepMessage:"",processed:0,total:0,errors:[],lastResult:null}),ae=d.useRef(!1),lt=async()=>{try{C(!0);const e=await wt();N(e),C(!1)}catch(e){M(e.message),C(!1)}};ce.useEffect(()=>{lt()},[]),ce.useEffect(()=>{if(!I.trim()){Ee(null);return}const e=setTimeout(async()=>{Ue(!0);try{const r=await bt(I);Ee(r)}catch(r){console.error("Search failed:",r),Ee(null)}finally{Ue(!1)}},300);return()=>clearTimeout(e)},[I]);const q=n.filter(e=>!e.classified_at),z=n.filter(e=>e.classified_at),at={mcp:n.filter(e=>$(e.tags,"persona:mcp_developer")).length,founder:n.filter(e=>$(e.tags,"persona:startup_founder")).length,investor:n.filter(e=>$(e.tags,"persona:vc_investor")).length},He=n.flatMap(e=>e.tags??[]),Ge=He.filter(e=>e.startsWith("tech:")).reduce((e,r)=>{const s=r.slice(5);return e[s]=(e[s]||0)+1,e},{}),he=Object.entries(Ge).filter(([,e])=>e>1).sort((e,r)=>r[1]-e[1]).map(([e])=>e),ct=u?he:he.slice(0,15),it=he.length>15,ze=He.filter(e=>e.startsWith("type:")).reduce((e,r)=>{const s=r.slice(5);return e[s]=(e[s]||0)+1,e},{}),ge=Object.entries(ze).filter(([,e])=>e>1).sort((e,r)=>r[1]-e[1]).map(([e])=>e),dt=x?ge:ge.slice(0,15),ut=ge.length>15,Ne={};for(const e of n){const r=Ze(e.url);r&&(Ne[r]=(Ne[r]||0)+1)}const me=Object.entries(Ne).filter(([,e])=>e>1).sort((e,r)=>r[1]-e[1]).map(([e])=>e),pt=H?me:me.slice(0,15),ht=me.length>15,Ve=new Map,te=(Fe?Fe.filter(e=>!(Z==="content"&&!e.matches.content||Z==="research"&&!e.matches.research||Z==="insight"&&!e.matches.insight)).map(e=>(Ve.set(e.bookmark.url,e.matches),e.bookmark)):n).filter(e=>!(D&&e.classified_at||O==="mcp"&&!$(e.tags,"persona:mcp_developer")||O==="founder"&&!$(e.tags,"persona:startup_founder")||O==="investor"&&!$(e.tags,"persona:vc_investor")||F&&!$(e.tags,`tech:${F}`)||U&&!$(e.tags,`type:${U}`)||J!==null&&e.stars!==J||f&&Ze(e.url)!==f)).sort((e,r)=>{if(L==="none")return 0;if(L==="published"){const s=e.published_at?new Date(e.published_at).getTime():0;return(r.published_at?new Date(r.published_at).getTime():0)-s}if(L==="rating")return(r.stars||0)-(e.stars||0);if(L==="alpha")return(e.title||e.url).localeCompare(r.title||r.url);if(L==="enriched"){const s=e.classified_at?new Date(e.classified_at).getTime():0,l=r.classified_at?new Date(r.classified_at).getTime():0;return s-l}return 0});ne.current=te;const gt=async e=>{if(!p.isRunning){ae.current=!1,y({isRunning:!0,current:e.title||e.url,currentStep:1,stepMessage:"Starting...",processed:0,total:1,errors:[],lastResult:null});try{const r=await Ie(e,(i,o)=>{y(v=>({...v,currentStep:i,stepMessage:o}))});y(i=>({...i,currentStep:3,stepMessage:"Saving to database..."}));const s=await fetch("/api/bookmarks/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Failed to save");const l=await s.json(),a=et(l);N(i=>i.map(o=>o.url===a.url?a:o)),y(i=>({...i,isRunning:!1,current:null,processed:1,lastResult:`âœ“ ${e.title||e.url}`}))}catch(r){const s=r.message;ue(l=>new Map(l).set(e.url,s)),y(l=>({...l,isRunning:!1,errors:[...l.errors,`${e.url}: ${s}`]}))}}};ce.useEffect(()=>{if(p.isRunning||we.length===0)return;const e=we[0],r=n.find(s=>s.url===e);Me(s=>s.slice(1)),r&&gt(r)},[we,p.isRunning]),ce.useEffect(()=>{if(!re||se===null||p.isRunning||G||X)return;const e=te[se];e&&!e.classified_at&&Te(e.url)},[se]);const We=async(e=10,r)=>{ae.current=!1;const s=r?r.slice(0,e):q.slice(0,e),l=[];E.research&&l.push("Research"),E.content&&l.push("Content"),E.analysis&&l.push("Analysis");const a=l.join(" + ")||"Nothing";y({isRunning:!0,current:null,currentStep:0,stepMessage:`Initializing (${a})...`,processed:0,total:s.length,errors:[],lastResult:null});const i=10,o=[];let v=!1;const k=async(m=!1)=>{if(v||o.length<i&&!m||o.length===0)return;v=!0;const V=o.splice(0,i);console.log(`[Batch] Flushing ${V.length} bookmarks...`);try{const w=await Pe(async()=>{const c=await fetch("/api/bookmarks/batch-update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookmarks:V})});if(!c.ok){const A=await c.text();throw console.error("[Batch] Error response:",c.status,A),new Error(`Batch save failed (${c.status}): ${A.slice(0,100)}`)}return c.json()}),{results:T}=w;for(const c of T)if(c.success&&c.data){const A=et(c.data);N(ye=>ye.map(je=>je.url===A.url?A:je)),y(ye=>({...ye,lastResult:`âœ“ ${c.data?.title||c.url}`}))}else c.success||(ue(A=>new Map(A).set(c.url,c.error||"Unknown error")),y(A=>({...A,errors:[...A.errors,`${c.url}: ${c.error}`]})));console.log(`[Batch] Saved ${T.filter(c=>c.success).length}/${T.length}`)}catch(w){console.error("[Batch] Flush error:",w);for(const T of V)ue(c=>new Map(c).set(T.url,w.message)),y(c=>({...c,errors:[...c.errors,`${T.url}: ${w.message}`]}))}finally{v=!1,o.length>=i&&k()}},xe=async m=>{if(ae.current)return;const V=m.title||m.url;Be(w=>new Set(w).add(m.url)),y(w=>({...w,current:`${w.processed+1}/${w.total}: ${V}`,stepMessage:`Processing ${nt.size+1} bookmarks...`}));try{let w;if(E.analysis&&(!E.research||!E.content)){const{getBookmarkContent:c}=await yt(async()=>{const{getBookmarkContent:ye}=await import("./bookmark-modal.D_NTTl-S.js").then(je=>je.a);return{getBookmarkContent:ye}},__vite__mapDeps([0,1,2])),A=await c(m.url);A&&(w={research:A.perplexity_research||void 0,content:A.firecrawl_content||void 0})}const T=await Ie(m,()=>{},{runResearch:E.research,runContent:E.content,runAnalysis:E.analysis},w);o.push(T),y(c=>({...c,processed:c.processed+1,stepMessage:`Enriched (${o.length} pending save)...`})),k()}catch(w){const T=w.message;ue(c=>new Map(c).set(m.url,T)),y(c=>({...c,processed:c.processed+1,errors:[...c.errors,`${m.url}: ${T}`]}))}finally{Be(w=>{const T=new Set(w);return T.delete(m.url),T})}},Ye=[...s],qe=[],ft=async()=>{for(;Ye.length>0&&!ae.current;){const m=Ye.shift();if(m)try{await xe(m)}catch(V){console.error("[Worker] Unhandled error:",V),y(w=>({...w,processed:w.processed+1,errors:[...w.errors,`${m.url}: Unhandled error`]}))}}};for(let m=0;m<Math.min(Se,s.length);m++)m>0&&await new Promise(V=>setTimeout(V,500)),qe.push(ft());if(await Promise.all(qe),o.length>0)for(y(m=>({...m,stepMessage:`Saving ${o.length} remaining...`})),await k(!0);o.length>0;)await new Promise(m=>setTimeout(m,100)),await k(!0);y(m=>({...m,isRunning:!1,current:null,stepMessage:ae.current?"Stopped":"Complete!"}))},mt=()=>{ae.current=!0,y(e=>({...e,stepMessage:"Stopping..."}))},Ke=async()=>{const e=le.trim();if(e){try{new URL(e)}catch{y(r=>({...r,errors:[...r.errors,`Invalid URL: ${e}`]}));return}if(n.some(r=>r.url===e)){y(r=>({...r,errors:[...r.errors,`URL already exists: ${e}`]}));return}ke(!0);try{const r=await fetch("/api/bookmarks/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(r.ok&&(await r.json()).exists){y(v=>({...v,errors:[...v.errors,`URL already exists in database: ${e}`]})),ke(!1);return}De("");const s=await fetch("/api/bookmarks/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!s.ok){const o=await s.text();throw new Error(`Failed to add URL: ${o}`)}const l={id:0,url:e,title:null,description:null,stars:null,icon:null,classified_at:null,published_at:null,tags:[]};N(o=>[l,...o]),y({isRunning:!0,current:e,currentStep:0,stepMessage:"Starting enrichment...",processed:0,total:1,errors:[],lastResult:null});const a=await Ie(l,(o,v)=>{y(k=>({...k,currentStep:o,stepMessage:v}))},{runResearch:E.research,runContent:E.content,runAnalysis:E.analysis}),i=await fetch("/api/bookmarks/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)throw new Error(`Failed to save enriched bookmark: ${i.status}`);N(o=>o.map(v=>v.url===e?{...v,title:a.title,description:a.description,icon:a.icon,stars:a.stars,classified_at:a.classified_at,published_at:a.published_at,tags:a.tags}:v)),Qe(),y(o=>({...o,isRunning:!1,processed:1,stepMessage:"Done!",lastResult:`âœ“ ${e}`}))}catch(r){const s=r instanceof Error?r.message:String(r);y(l=>({...l,isRunning:!1,errors:[...l.errors,`Import failed: ${s}`]}))}finally{ke(!1)}}};if(j)return t.jsx("div",{className:"container py-16 text-center",children:t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-2",style:{borderColor:"var(--color-border)",borderTopColor:"var(--color-accent)"}})});if(g)return t.jsx("div",{className:"container py-16 text-center",children:t.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",g]})});const fe=(I||O||F||U||f||J||L==="enriched"?te.filter(e=>e.classified_at):z.slice()).sort((e,r)=>{const s=e.classified_at?new Date(e.classified_at).getTime():0,l=r.classified_at?new Date(r.classified_at).getTime():0;return s-l});return t.jsxs("div",{className:"container py-8",children:[t.jsx(xt,{title:"Bookmarks",subtitle:re?`${n.length} links Â· ${z.length} enriched Â· ${q.length} pending`:`${z.length} curated links`}),re&&t.jsx("div",{className:"sticky z-30 -mx-4 px-4 pb-3 pt-2 mb-4",style:{top:"57px",backgroundColor:"var(--color-bg)"},children:t.jsxs("div",{className:"p-3 rounded-xl",style:{backgroundColor:"var(--color-bg-secondary)",border:`2px solid ${p.isRunning?"var(--color-accent)":"var(--color-border)"}`},children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-lg font-semibold",style:{color:"var(--color-fg)"},children:"ğŸ”¬ Enrichment"}),p.isRunning&&t.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium animate-pulse",style:{backgroundColor:"#f5930030",color:"#f59300"},children:[p.processed,"/",p.total]})]}),t.jsxs("div",{className:"flex items-center gap-3 border-l border-[var(--color-border)] pl-4",children:[t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-sm",children:[t.jsx("input",{type:"checkbox",checked:E.research,onChange:e=>_e(r=>({...r,research:e.target.checked})),className:"w-3.5 h-3.5 rounded accent-[var(--color-accent)]"}),t.jsx("span",{style:{color:"var(--color-fg-muted)"},children:"Research"})]}),t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-sm",children:[t.jsx("input",{type:"checkbox",checked:E.content,onChange:e=>_e(r=>({...r,content:e.target.checked})),className:"w-3.5 h-3.5 rounded accent-[var(--color-accent)]"}),t.jsx("span",{style:{color:"var(--color-fg-muted)"},children:"Content"})]}),t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-sm",children:[t.jsx("input",{type:"checkbox",checked:E.analysis,onChange:e=>_e(r=>({...r,analysis:e.target.checked})),className:"w-3.5 h-3.5 rounded accent-[var(--color-accent)]"}),t.jsx("span",{style:{color:"var(--color-fg-muted)"},children:"Analysis"})]})]}),!p.isRunning&&t.jsxs("div",{className:"flex items-center gap-3 border-l border-[var(--color-border)] pl-4",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("label",{htmlFor:"batch-input",className:"text-xs",style:{color:"var(--color-fg-muted)"},children:"Batch:"}),t.jsx("input",{id:"batch-input",type:"text",inputMode:"numeric",pattern:"[0-9]*",defaultValue:oe,onBlur:e=>{const r=Number.parseInt(e.target.value)||5;rt(Math.max(1,Math.min(500,r)))},onKeyDown:e=>{e.key==="Enter"&&e.currentTarget.blur()},className:"w-12 px-1.5 py-1 rounded text-xs text-center font-medium",style:{backgroundColor:"var(--color-bg)",border:"1px solid var(--color-border)",color:"var(--color-fg)"}},`batch-${oe}`)]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("label",{htmlFor:"parallel-input",className:"text-xs",style:{color:"var(--color-fg-muted)"},children:"Parallel:"}),t.jsx("input",{id:"parallel-input",type:"text",inputMode:"numeric",pattern:"[0-9]*",defaultValue:Se,onBlur:e=>{const r=Number.parseInt(e.target.value)||3;st(Math.max(1,Math.min(10,r)))},onKeyDown:e=>{e.key==="Enter"&&e.currentTarget.blur()},className:"w-12 px-1.5 py-1 rounded text-xs text-center font-medium",style:{backgroundColor:"var(--color-bg)",border:"1px solid var(--color-border)",color:"var(--color-fg)"}},`parallel-${Se}`)]})]}),t.jsx("div",{className:"flex items-center gap-2 ml-auto",children:p.isRunning?t.jsx("button",{type:"button",onClick:mt,className:"px-3 py-1.5 rounded-lg text-xs font-semibold transition-all hover:scale-105",style:{backgroundColor:"#ef4444",color:"white"},children:"â¹ Stop"}):t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",onClick:()=>We(oe),disabled:q.length===0,className:"px-3 py-1.5 rounded-lg text-xs font-semibold transition-all hover:scale-105",style:{backgroundColor:q.length>0?"var(--color-accent)":"var(--color-bg)",color:q.length>0?"#000":"var(--color-fg-muted)"},title:`Enrich ${Math.min(oe,q.length)} new bookmarks`,children:["ğŸš€ New (",q.length,")"]}),t.jsx("button",{type:"button",onClick:()=>We(oe,fe),disabled:fe.length===0,className:"px-3 py-1.5 rounded-lg text-xs font-semibold transition-all hover:scale-105",style:{backgroundColor:fe.length>0?"#8b5cf6":"var(--color-bg)",color:fe.length>0?"#fff":"var(--color-fg-muted)"},title:`Re-enrich ${Math.min(oe,fe.length)} oldest enriched`,children:"ğŸ”„ Re-enrich"})]})})]}),!p.isRunning&&t.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center gap-3",style:{borderColor:"var(--color-border)"},children:[t.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-fg-muted)"},children:"Import:"}),t.jsx("input",{type:"url",placeholder:"Paste URL to add...",value:le,onChange:e=>De(e.target.value),onKeyDown:e=>{e.key==="Enter"&&le.trim()&&Ke()},disabled:pe,className:"flex-1 max-w-md px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-bg)",border:"1px solid var(--color-border)",color:"var(--color-fg)"}}),t.jsx("button",{type:"button",onClick:Ke,disabled:!le.trim()||pe,className:"px-3 py-1.5 rounded-lg text-xs font-semibold transition-all hover:scale-105",style:{backgroundColor:le.trim()&&!pe?"#10b981":"var(--color-bg)",color:le.trim()&&!pe?"#fff":"var(--color-fg-muted)",border:"1px solid var(--color-border)"},children:pe?"Importing...":"â• Add & Enrich"})]}),p.isRunning&&t.jsxs("div",{className:"mt-3 pt-3 border-t text-sm flex items-center gap-4",style:{borderColor:"var(--color-border)"},children:[t.jsx("span",{style:{color:"var(--color-fg)"},children:p.current}),t.jsx("span",{style:{color:"var(--color-fg-muted)"},children:p.stepMessage}),p.errors.length>0&&t.jsxs("span",{className:"text-red-400 text-xs",children:[p.errors.length," errors"]})]}),!p.isRunning&&p.errors.length>0&&t.jsxs("details",{className:"mt-2",children:[t.jsxs("summary",{className:"text-xs cursor-pointer text-red-400",children:[p.errors.length," error(s) - click to view"]}),t.jsx("div",{className:"mt-1 p-2 rounded text-xs max-h-24 overflow-y-auto",style:{backgroundColor:"var(--color-bg)"},children:p.errors.map(e=>t.jsx("div",{className:"text-red-400",children:e},e))})]})]})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[t.jsxs("div",{className:"relative flex-1 max-w-xs",children:[t.jsx("input",{type:"text",placeholder:"Search...",value:I,onChange:e=>W(e.target.value),className:"px-4 py-2 rounded-lg text-sm w-full",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-fg)"}}),Re&&t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2",style:{color:"var(--color-accent)"},children:t.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),re&&t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:D,onChange:e=>K(e.target.checked),className:"rounded"}),t.jsxs("span",{style:{color:"var(--color-fg-muted)"},children:["Unenriched only (",q.length,")"]})]})]}),I&&t.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[t.jsx("span",{className:"text-xs py-1",style:{color:"var(--color-fg-muted)"},children:"Match in:"}),["all","content","research","insight"].map(e=>{const r=Z===e,s={all:"All",content:"ğŸŒ Content",research:"ğŸ”¬ Research",insight:"ğŸ’¡ Insight"},l={all:"#6b7280",content:"#06b6d4",research:"#3b82f6",insight:"#8b5cf6"};return t.jsx("button",{type:"button",onClick:()=>tt(e),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:r?`${l[e]}20`:"var(--color-bg-secondary)",color:r?l[e]:"var(--color-fg-muted)",border:`1px solid ${r?l[e]:"var(--color-border)"}`},children:s[e]},e)}),t.jsxs("span",{className:"text-xs ml-2",style:{color:"var(--color-fg-muted)"},children:["(",te.length," results)"]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.jsx("span",{className:"text-xs py-1",style:{color:"var(--color-fg-muted)"},children:"Audience:"}),["mcp","founder","investor"].map(e=>t.jsxs("button",{type:"button",onClick:()=>b(e===O?null:e),className:"px-3 py-1 rounded-full text-xs font-medium transition-all",style:{backgroundColor:O===e?`${be[e].color}30`:"var(--color-bg-secondary)",color:O===e?be[e].color:"var(--color-fg-muted)",border:`1px solid ${O===e?be[e].color:"var(--color-border)"}`},children:[be[e].icon," ",be[e].label," (",at[e],")"]},e))]}),he.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.jsx("span",{className:"text-xs py-1",style:{color:"var(--color-fg-muted)"},children:"Tech:"}),ct.map(e=>t.jsxs("button",{type:"button",onClick:()=>ie(e===F?null:e),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:F===e?"#6366f130":"var(--color-bg-secondary)",color:F===e?"#6366f1":"var(--color-fg-muted)",border:`1px solid ${F===e?"#6366f1":"var(--color-border)"}`},children:[e," (",Ge[e],")"]},e)),it&&t.jsx("button",{type:"button",onClick:()=>S(!u),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:"transparent",color:"var(--color-accent)",border:"1px dashed var(--color-border)"},children:u?"show less":`+${he.length-15} more...`})]}),ge.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.jsx("span",{className:"text-xs py-1",style:{color:"var(--color-fg-muted)"},children:"Type:"}),dt.map(e=>t.jsxs("button",{type:"button",onClick:()=>Q(e===U?null:e),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:U===e?"#f5930030":"var(--color-bg-secondary)",color:U===e?"#f59300":"var(--color-fg-muted)",border:`1px solid ${U===e?"#f59300":"var(--color-border)"}`},children:[e," (",ze[e],")"]},e)),ut&&t.jsx("button",{type:"button",onClick:()=>h(!x),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:"transparent",color:"var(--color-accent)",border:"1px dashed var(--color-border)"},children:x?"show less":`+${ge.length-15} more...`})]}),me.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.jsx("span",{className:"text-xs py-1",style:{color:"var(--color-fg-muted)"},children:"Platform:"}),pt.map(e=>t.jsxs("button",{type:"button",onClick:()=>Y(e===f?null:e),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:f===e?"#10b98130":"var(--color-bg-secondary)",color:f===e?"#10b981":"var(--color-fg-muted)",border:`1px solid ${f===e?"#10b981":"var(--color-border)"}`},children:[e," (",Ne[e],")"]},e)),ht&&t.jsx("button",{type:"button",onClick:()=>de(!H),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:"transparent",color:"var(--color-accent)",border:"1px dashed var(--color-border)"},children:H?"show less":`+${me.length-15} more...`})]}),t.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs py-1",style:{color:"var(--color-fg-muted)"},children:"Stars:"}),[1,2,3,4,5].map(e=>t.jsx("button",{type:"button",onClick:()=>_(J===e?null:e),className:"px-2 py-0.5 rounded text-xs font-medium transition-all",style:{backgroundColor:J===e?"#eab30830":"var(--color-bg-secondary)",color:J===e?"#eab308":"var(--color-fg-muted)",border:`1px solid ${J===e?"#eab308":"var(--color-border)"}`},children:"â­".repeat(e)},e))]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-xs py-1 mr-1",style:{color:"var(--color-fg-muted)"},children:"Sort:"}),["published","rating","enriched","alpha","none"].map(e=>{const r=L===e,s={published:"ğŸ“…",rating:"â­",enriched:"ğŸ”„",alpha:"A-Z",none:"â€”"},l={published:"Sort by recently published",rating:"Sort by rating",enriched:"Sort by oldest enriched (for re-enrichment)",alpha:"Sort alphabetically",none:"No sorting"};return t.jsx("button",{type:"button",onClick:()=>Ce(e),className:"px-2 py-0.5 rounded text-xs font-medium transition-all cursor-pointer",style:{backgroundColor:r?"#8b5cf630":"var(--color-bg-secondary)",color:r?"#8b5cf6":"var(--color-fg-muted)",border:`1px solid ${r?"#8b5cf6":"var(--color-border)"}`},title:l[e],children:s[e]},e)})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none transition-opacity duration-200",style:{backgroundColor:"var(--color-bg)",opacity:Re?.6:0}}),Re&&t.jsx("div",{className:"absolute inset-0 z-20 flex items-start justify-center pt-24 pointer-events-none",children:t.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 rounded-lg",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)"},children:[t.jsxs("svg",{className:"animate-spin h-5 w-5",style:{color:"var(--color-accent)"},xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-fg)"},children:"Searching..."})]})}),t.jsx("div",{className:"lg:hidden space-y-3",children:te.map((e,r)=>{const s=p.current===e.title||p.current===e.url,a=!!Oe.get(e.url);return t.jsx("button",{type:"button",className:"rounded-xl p-4 cursor-pointer active:scale-[0.98] transition-transform w-full text-left",style:{backgroundColor:a?"rgba(239, 68, 68, 0.1)":"var(--color-bg-secondary)",border:a?"2px solid rgba(239, 68, 68, 0.5)":"1px solid var(--color-border)"},onClick:()=>{R(r),P(e.url)},children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("span",{className:"text-2xl",children:e.icon||"ğŸ”—"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold truncate",style:{color:"var(--color-fg)"},children:e.title||new URL(e.url).hostname}),e.classified_at&&t.jsx("span",{className:"shrink-0",children:t.jsx(Xe,{stars:e.stars})})]}),t.jsx("p",{className:"text-sm mt-1 line-clamp-2",style:{color:"var(--color-fg-muted)"},children:e.description}),t.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs mt-2 truncate block",style:{color:"var(--color-accent)"},onClick:i=>i.stopPropagation(),children:e.url}),e.classified_at&&t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),P(e.url,"dev")},className:"px-2.5 py-1.5 rounded-lg text-xs",style:{backgroundColor:"#8b5cf620",color:"#8b5cf6"},children:"ğŸ”Œ Dev"}),t.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),P(e.url,"founder")},className:"px-2.5 py-1.5 rounded-lg text-xs",style:{backgroundColor:"#f5930020",color:"#f59300"},children:"ğŸš€ Founder"}),t.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),P(e.url,"investor")},className:"px-2.5 py-1.5 rounded-lg text-xs",style:{backgroundColor:"#10b98120",color:"#10b981"},children:"ğŸ’° Investor"})]}),s&&t.jsx("span",{className:"inline-block mt-2 px-2 py-0.5 rounded text-xs animate-pulse",style:{backgroundColor:"#f5930020",color:"#f59300"},children:"Processing..."})]})]})},`mobile-${e.url}-${r}`)})}),t.jsx("div",{className:"rounded-lg overflow-hidden hidden lg:block",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)"},children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"var(--color-bg)",borderBottom:"1px solid var(--color-border)"},children:[t.jsx("th",{className:"text-left p-3 font-medium",style:{width:"40px"}}),t.jsx("th",{className:"text-left p-3 font-medium",style:{width:"300px",maxWidth:"300px"},children:"Content"}),t.jsx("th",{className:"text-center p-3 font-medium",style:{width:"80px"},children:"Rating"}),t.jsx("th",{className:"text-left p-3 pl-6 font-medium",children:"Insights"}),t.jsx("th",{className:"text-center p-3 font-medium",style:{width:"100px"},children:"Published"}),t.jsx("th",{className:"text-center p-3 font-medium",style:{width:"100px"},children:"Analyzed"}),re&&t.jsx("th",{className:"text-center p-3 font-medium",style:{width:"80px"},children:"Actions"})]})}),t.jsx("tbody",{children:te.map((e,r)=>{const s=p.current===e.title||p.current===e.url,l=se===r,a=Oe.get(e.url),i=!!a;return t.jsxs("tr",{id:`bookmark-row-${r}`,tabIndex:0,className:"hover:bg-(--color-bg) transition-colors group cursor-pointer",style:{borderBottom:"1px solid var(--color-border)",backgroundColor:i?"rgba(239, 68, 68, 0.1)":l?"var(--color-accent-muted, rgba(59, 130, 246, 0.1))":void 0,outline:i?"2px solid rgba(239, 68, 68, 0.5)":l?"2px solid var(--color-accent)":void 0},onClick:()=>{R(r),P(e.url)},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),R(r),P(e.url))},title:i?`Error: ${a}`:"Click to view insights",children:[t.jsx("td",{className:"p-3 text-center",children:t.jsx("span",{className:"text-lg",children:e.icon||"ğŸ”—"})}),t.jsxs("td",{className:"p-3",style:{maxWidth:"300px"},children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("div",{className:"font-medium truncate flex-1",style:{color:"var(--color-fg)"},children:e.title||new URL(e.url).hostname})}),t.jsx("div",{className:"text-xs mt-0.5 line-clamp-1",style:{color:"var(--color-fg-muted)"},children:e.description}),t.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs mt-0.5 truncate block hover:underline",style:{color:"var(--color-accent)",opacity:.7},children:e.url}),I&&(()=>{const o=Ve.get(e.url);if(!o)return null;const v=[];return o.content&&v.push({label:"Content",color:"#06b6d4"}),o.research&&v.push({label:"Research",color:"#3b82f6"}),o.insight&&v.push({label:"Insight",color:"#8b5cf6"}),v.length===0?null:t.jsx("div",{className:"flex gap-1 mt-1",children:v.map(k=>t.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium",style:{backgroundColor:`${k.color}20`,color:k.color},children:[k.label," Match"]},k.label))})})()]}),t.jsx("td",{className:"p-3 text-center",children:e.classified_at?t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),R(r),P(e.url)},className:"hover:scale-110 transition-transform cursor-pointer",title:"View Developer Insight",children:t.jsx(Xe,{stars:e.stars})}):s?t.jsx("span",{className:"px-2 py-0.5 rounded text-xs animate-pulse",style:{backgroundColor:"#f5930020",color:"#f59300"},children:"..."}):t.jsx("span",{className:"text-gray-500 text-xs",children:"â€”"})}),t.jsx("td",{className:"p-3 pl-6",children:e.classified_at?t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),R(r),P(e.url,"dev")},className:"px-2 py-1 rounded text-xs transition-colors cursor-pointer hover:scale-110",style:{backgroundColor:"#8b5cf620",color:"#8b5cf6"},title:"Dev Insight",children:"ğŸ”Œ"}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),R(r),P(e.url,"founder")},className:"px-2 py-1 rounded text-xs transition-colors cursor-pointer hover:scale-110",style:{backgroundColor:"#f5930020",color:"#f59300"},title:"Founder Insight",children:"ğŸš€"}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),R(r),P(e.url,"investor")},className:"px-2 py-1 rounded text-xs transition-colors cursor-pointer hover:scale-110",style:{backgroundColor:"#10b98120",color:"#10b981"},title:"Investor Insight",children:"ğŸ’°"}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),R(r),P(e.url,"research")},className:"px-2 py-1 rounded text-xs transition-colors cursor-pointer hover:scale-110",style:{backgroundColor:"#3b82f620",color:"#3b82f6"},title:"Research",children:"ğŸ”¬"}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),R(r),P(e.url,"exa")},className:"px-2 py-1 rounded text-xs transition-colors cursor-pointer hover:scale-110",style:{backgroundColor:"#06b6d420",color:"#06b6d4"},title:"Page Content",children:"ğŸŒ"})]}):t.jsx("span",{className:"text-gray-500 text-xs",children:"â€”"})}),t.jsx("td",{className:"p-3 text-center",children:e.published_at?t.jsx("span",{className:"text-xs",style:{color:"var(--color-fg-muted)"},title:new Date(e.published_at).toLocaleString(),children:new Date(e.published_at).toLocaleDateString("en-US",{month:"short",year:"numeric"})}):t.jsx("span",{className:"text-gray-500 text-xs",children:"â€”"})}),t.jsx("td",{className:"p-3 text-center",children:e.classified_at?t.jsx("span",{className:"text-xs",style:{color:"var(--color-fg-muted)"},title:new Date(e.classified_at).toLocaleString(),children:new Date(e.classified_at).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"})}):t.jsx("span",{className:"text-gray-500 text-xs",children:"â€”"})}),re&&t.jsx("td",{className:"p-3 text-center",children:(()=>{const o=we.indexOf(e.url),v=p.isRunning&&p.current===(e.title||e.url),k=!!e.classified_at;return v?t.jsx("span",{className:"px-2 py-1 rounded text-xs animate-pulse",style:{backgroundColor:"#f59e0b20",color:"#f59e0b"},children:"â³"}):o>=0?t.jsxs("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:"#8b5cf620",color:"#8b5cf6"},title:`Queue position: ${o+1}`,children:["#",o+1]}):i?t.jsx("button",{type:"button",onClick:xe=>{xe.stopPropagation(),Te(e.url)},className:"px-2 py-1 rounded text-xs transition-colors hover:scale-105 cursor-pointer",style:{backgroundColor:"rgba(239, 68, 68, 0.2)",color:"#ef4444"},title:`Failed: ${a}
Click to retry`,children:"âš ï¸ Retry"}):t.jsx("button",{type:"button",onClick:xe=>{xe.stopPropagation(),Te(e.url)},className:"px-2 py-1 rounded text-xs transition-colors hover:scale-105 cursor-pointer",style:{backgroundColor:k?"var(--color-bg-subtle)":"var(--color-accent)",color:k?"var(--color-fg-muted)":"#000",border:k?"1px solid var(--color-border)":"none"},title:k?"Re-enrich this bookmark":"Enrich this bookmark",children:k?"ğŸ”„":"âœ¨"})})()})]},`${e.url}-${r}`)})})]})})})]}),te.length===0&&t.jsx("div",{className:"text-center py-16",children:t.jsx("p",{style:{color:"var(--color-fg-muted)"},children:"No bookmarks match your filters"})}),z.length>0&&t.jsxs("div",{className:"mt-6 p-4 rounded-lg grid grid-cols-2 md:grid-cols-4 gap-4",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)"},children:[t.jsxs("div",{children:[t.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--color-fg)"},children:[(z.reduce((e,r)=>e+(r.stars||0),0)/z.length).toFixed(1),"â­"]}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-fg-muted)"},children:"Avg Rating"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold",style:{color:"#8b5cf6"},children:z.filter(e=>$(e.tags,"persona:mcp_developer")).length}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-fg-muted)"},children:"MCP Developer"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold",style:{color:"#f59300"},children:z.filter(e=>$(e.tags,"persona:startup_founder")).length}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-fg-muted)"},children:"Startup Founder"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold",style:{color:"#10b981"},children:z.filter(e=>$(e.tags,"persona:vc_investor")).length}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-fg-muted)"},children:"VC Investor"})]})]}),X&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.7)"},onClick:()=>ee(null),onKeyDown:e=>{e.key==="Escape"&&ee(null)},children:t.jsxs("dialog",{ref:e=>e?.focus(),open:!0,tabIndex:-1,className:"max-w-md w-full rounded-xl p-6 m-0 outline-none",style:{backgroundColor:"var(--color-bg)",border:"2px solid #ef4444"},onClick:e=>e.stopPropagation(),onKeyDown:e=>{e.key==="Escape"&&ee(null)},children:[t.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"#ef4444"},children:"ğŸ—‘ï¸ Delete Bookmark?"}),t.jsx("p",{className:"mb-4",style:{color:"var(--color-fg-muted)"},children:"Are you sure you want to delete this bookmark?"}),t.jsxs("div",{className:"p-3 rounded-lg mb-4 truncate",style:{backgroundColor:"var(--color-bg-secondary)"},children:[t.jsx("div",{className:"font-medium",style:{color:"var(--color-fg)"},children:X.title}),t.jsx("div",{className:"text-sm truncate",style:{color:"var(--color-fg-muted)"},children:X.url})]}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx("button",{type:"button",onClick:()=>ee(null),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-fg)",border:"1px solid var(--color-border)"},children:"Cancel (Esc)"}),t.jsx("button",{type:"button",onClick:()=>Le(X.url),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"#ef4444",color:"#fff"},children:"Delete (Enter)"})]})]})}),B&&G&&t.jsx(vt,{bookmark:{url:B.url,title:B.title,icon:B.icon,published_at:B.published_at,classified_at:B.classified_at,tags:B.tags},initialTab:G.tab,onClose:ot,onNavigateBookmark:e=>{const r=ne.current,s=r.findIndex(l=>l.url===B.url);if(e==="next"){const l=s+1,a=r[l];l<r.length&&a&&(R(l),ve({url:a.url,tab:G.tab}))}else{const l=s-1,a=r[l];l>=0&&a&&(R(l),ve({url:a.url,tab:G.tab}))}},canNavigatePrev:ne.current.findIndex(e=>e.url===B.url)>0,canNavigateNext:ne.current.findIndex(e=>e.url===B.url)<ne.current.length-1}),t.jsx("div",{className:"text-center py-6 mt-8",children:t.jsx("button",{type:"button",onClick:()=>{Qe(),window.location.reload()},className:"text-xs opacity-30 hover:opacity-60 transition-opacity cursor-pointer",style:{color:"var(--color-fg-muted)"},children:"Clear cached bookmarks"})})]})}export{Tt as BookmarksEdit};
